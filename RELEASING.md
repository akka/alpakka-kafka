# Releasing

1. If this is a new minor (not patch) release, ask someone in the Alpakka or Akka team to rename the 'alpakka-kafka-xx-stable' report in [WhiteSource](https://saas.whitesourcesoftware.com) to reflect the latest version (unfortunately this requires permissions that cannot be shared in a granular way)
1. Check [closed issues without a milestone](https://github.com/akka/alpakka-kafka/issues?utf8=%E2%9C%93&q=is%3Aissue%20is%3Aclosed%20no%3Amilestone) and either assign them the 'upcoming' release milestone or 'invalid'
1. Create a [new release](https://github.com/akka/alpakka-kafka/releases/new) with:
    * the next tag version (e.g. `v0.21`)
    * title and release description including notable changes
    * link to the [milestone](https://github.com/akka/alpakka-kafka/milestones) showing an overview of closed issues for this release
    * overview of contributors generated by [`sbt-authors`](https://github.com/2m/authors) (eg. `sbt authors v0.20 v0.21`)
1. Travis CI will start a [CI build](https://travis-ci.org/akka/alpakka-kafka/builds) for the new tag and publish artifacts to Bintray.
    * When the travis build fails it must be restarted. Artifacts may already have been pushed to Bintray, however, so remove them there before restarting the build.
1. Login to [Bintray](https://bintray.com/akka/maven/alpakka-kafka) and sync artifacts to Maven Central:
    * Go to the 'Maven Central' tab and use your sonatype credentials. This can take a long time (you can check https://oss.sonatype.org/#stagingRepositories for progress)
1. Close the milestone for this release and start a new one.

# Publishing docs

1. Checkout the newly released tag.
1. If you need to make any changes to the already released docs, create `version.sbt` and set the project version explicitly:
    ```
    ThisBuild / version := "<released-version>"
    ThisBuild / isSnapshot := false
    ```
1. Build paradox and API documentation:
    ```
    sbt docs/paradox core/doc
    ```
1. Upload docs to *gustav*:
    ```
    rsync -azP docs/target/paradox/site/main/ gustav.akka.io:www/docs/akka-stream-kafka/<new-version>/
    rsync -azP core/target/scala-2.12/api/ gustav.akka.io:www/api/akka-stream-kafka/<new-version>/
    ```
1. Update the current links on *gustav*:
    ```
    ln -snf <new-version> current in www/api/akka-stream-kafka/ and www/docs/akka-stream-kafka
    ```

If you don't have access to *gustav* ask someone from the core akka team to do it or give you access.
